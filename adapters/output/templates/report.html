<!-- adapters/output/templates/report.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è {{ platform_name }} - Security Report</title>
    {% include 'styles.html' %}
</head>
<body>
    <div class="container">
        
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- HEADER -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <header class="header">
            <div class="header-content">
                <h1>üõ°Ô∏è Security Analysis Report</h1>
                <div class="header-grid">
                    <div class="header-item">
                        <div class="header-label">üìÅ File</div>
                        <div class="header-value">{{ scan_result.file_info.filename }}</div>
                    </div>
                    <div class="header-item">
                        <div class="header-label">üìä Total Vulnerabilities</div>
                        <div class="header-value">{{ total_vulnerabilities }}</div>
                    </div>
                    <div class="header-item">
                        <div class="header-label">‚ö° High Priority</div>
                        <div class="header-value">{{ high_priority_count }}</div>
                    </div>
                    <div class="header-item">
                        <div class="header-label">üéØ Risk Score</div>
                        <div class="header-value">{{ risk_score }}/10</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="content">
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- EXECUTIVE SUMMARY -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <section class="section">
                <h2 class="section-title">üìà Executive Summary</h2>
                
                <div class="metrics-grid">
                    {% for severity, count in severity_stats.items() %}
                    {% if count > 0 %}
                    <div class="metric-card {{ severity | severity_class }}">
                        <div class="metric-icon">{{ severity | severity_icon }}</div>
                        <div class="metric-value">{{ count }}</div>
                        <div class="metric-label">{{ severity }}</div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>

                <div class="summary-info">
                    <p><strong>Analysis completed in {{ report.total_processing_time_seconds | format_duration }}</strong></p>
                    {% if report.chunking_enabled %}
                    <p>üß© Advanced chunking was used for optimal analysis</p>
                    {% endif %}
                    {% if triage_result %}
                    <p>ü§ñ AI-powered triage analyzed {{ triage_result.total_analyzed }} vulnerabilities</p>
                    {% endif %}
                </div>
            </section>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- VULNERABILITIES + REMEDIATION GRID -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            {% if scan_result.vulnerabilities %}
            <section class="section">
                <h2 class="section-title">üîê Security Analysis & Remediation</h2>
                
                <div class="vuln-remediation-grid">
                    {% for vuln in scan_result.vulnerabilities %}
                    <div class="analysis-pair {{ vuln.severity.value | severity_class }}-border">
                        
                        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                        <!-- LEFT: VULNERABILITY CARD -->
                        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                        <div class="vulnerability-side">
                            <div class="vuln-header-compact">
                                <div class="vuln-badge-row">
                                    <span class="badge severity-{{ vuln.severity.value | severity_class }}">
                                        {{ vuln.severity | severity_icon }} {{ vuln.severity.value }}
                                    </span>
                                    <span class="badge type-badge">{{ vuln.type.value }}</span>
                                </div>
                                <h3 class="vuln-title-compact">
                                    {{ loop.index }}. {{ vuln.title }}
                                </h3>
                            </div>
                            
                            <div class="vuln-body-compact">
                                <!-- Meta Information -->
                                <div class="vuln-meta-compact">
                                    <div class="meta-item-inline">
                                        <span class="meta-icon">üìç</span>
                                        <span class="meta-text">{{ vuln.file_path }}:{{ vuln.line_number }}</span>
                                    </div>
                                    {% if vuln.cwe_id %}
                                    <div class="meta-item-inline">
                                        <span class="meta-icon">üîó</span>
                                        <a href="https://cwe.mitre.org/data/definitions/{{ vuln.cwe_id.replace('CWE-', '') }}.html" 
                                           target="_blank" class="meta-link">
                                            {{ vuln.cwe_id }}
                                        </a>
                                    </div>
                                    {% endif %}
                                    <div class="meta-item-inline">
                                        <span class="meta-icon">üÜî</span>
                                        <span class="meta-text-small">{{ vuln.id }}</span>
                                    </div>
                                </div>
                                
                                <!-- Description -->
                                <div class="vuln-description-compact">
                                    <h4>üìù Description</h4>
                                    <p>{{ vuln.description }}</p>
                                </div>
                                
                                <!-- Code Snippet -->
                                {% if vuln.code_snippet %}
                                <div class="vuln-code-compact">
                                    <h4>üíª Vulnerable Code</h4>
                                    <pre class="code-block-compact">{{ vuln.code_snippet | truncate_smart(300) }}</pre>
                                </div>
                                {% endif %}
                                
                                <!-- Quick Advice (if no full plan) -->
                                {% if vuln.remediation_advice and not remediation_plans %}
                                <div class="vuln-advice-compact">
                                    <h4>üí° Quick Fix</h4>
                                    <div class="advice-content-compact">{{ vuln.remediation_advice }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                        <!-- RIGHT: REMEDIATION PLAN -->
                        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                        <div class="remediation-side">
                            {% set plan = remediation_plans | selectattr('vulnerability_id', 'equalto', vuln.id) | first %}
                            {% if plan %}
                                <div class="remediation-header-compact">
                                    <div class="plan-priority-row">
                                        <span class="priority-badge priority-{{ plan.priority_level }}">
                                            {{ plan.priority_level.upper() }}
                                        </span>
                                        <span class="complexity-badge">
                                            Complexity: {{ plan.complexity_score }}/10
                                        </span>
                                    </div>
                                    <h3 class="plan-title-compact">
                                        üõ†Ô∏è Remediation Plan
                                    </h3>
                                </div>
                                
                                <div class="plan-body-compact">
                                    <!-- Plan Stats -->
                                    <div class="plan-stats-row">
                                        <div class="stat-item">
                                            <span class="stat-icon">üìã</span>
                                            <span class="stat-text">{{ plan.steps | length }} steps</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-icon">‚è±Ô∏è</span>
                                            <span class="stat-text">
                                                {% set total_minutes = plan.steps | sum(attribute='estimated_minutes') %}
                                                {{ total_minutes }} min
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Implementation Steps -->
                                    <div class="plan-steps-compact">
                                        <h4>Implementation Steps:</h4>
                                        <ol class="steps-list-compact">
                                            {% for step in plan.steps %}
                                            <li class="step-item-compact">
                                                <div class="step-header-inline">
                                                    <strong>{{ step.title }}</strong>
                                                    <span class="step-meta-badge">
                                                        {{ step.estimated_minutes }}min ‚Ä¢ {{ step.difficulty }}
                                                    </span>
                                                </div>
                                                <p class="step-description-text">{{ step.description | truncate_smart(200) }}</p>
                                                {% if step.code_example %}
                                                <details class="step-code-details">
                                                    <summary class="code-toggle">üíª View Code Example</summary>
                                                    <pre class="step-code-example">{{ step.code_example | truncate_smart(400) }}</pre>
                                                </details>
                                                {% endif %}
                                            </li>
                                            {% endfor %}
                                        </ol>
                                    </div>
                                    
                                    <!-- Risk Warning -->
                                    {% if plan.risk_if_not_fixed %}
                                    <div class="risk-warning-compact">
                                        <h5>‚ö†Ô∏è Risk if not fixed:</h5>
                                        <p>{{ plan.risk_if_not_fixed }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- References -->
                                    {% if plan.references %}
                                    <div class="plan-references">
                                        <h5>üìö References:</h5>
                                        <ul class="references-list">
                                            {% for ref in plan.references %}
                                            <li><a href="{{ ref }}" target="_blank">{{ ref | truncate_smart(60) }}</a></li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                </div>
                            {% else %}
                                <!-- No Remediation Plan Available -->
                                <div class="no-plan-card">
                                    <div class="no-plan-icon">üìã</div>
                                    <h3>No Remediation Plan</h3>
                                    <p>Automatic remediation plan not available for this vulnerability.</p>
                                    <div class="manual-review-box">
                                        <strong>‚ö†Ô∏è Manual Review Required</strong>
                                        <p>Please review the vulnerability description and implement appropriate security fixes.</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        
                    </div>
                    {% endfor %}
                </div>
            </section>

            {% else %}
            <!-- No Vulnerabilities Found -->
            <section class="section">
                <div class="no-vulnerabilities">
                    <div class="no-vulns-icon">‚úÖ</div>
                    <h2>No Vulnerabilities Found</h2>
                    <p>Excellent! No security vulnerabilities were detected in the analyzed code.</p>
                </div>
            </section>
            {% endif %}

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TECHNICAL DETAILS -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <section class="section">
                <details class="technical-details">
                    <summary class="details-toggle">üîç Technical Analysis Details</summary>
                    <div class="details-content">
                        <div class="tech-grid">
                            <div class="tech-item">
                                <h4>üìä Analysis Statistics</h4>
                                <ul>
                                    <li>Processing time: {{ report.total_processing_time_seconds | format_duration }}</li>
                                    <li>File size: {{ scan_result.file_info.size_bytes | format_bytes }}</li>
                                    <li>Language: {{ scan_result.language_detected or 'Auto-detected' }}</li>
                                    <li>Chunking: {{ 'Enabled' if report.chunking_enabled else 'Disabled' }}</li>
                                </ul>
                            </div>
                            
                            {% if triage_result %}
                            <div class="tech-item">
                                <h4>ü§ñ LLM Triage Results</h4>
                                <ul>
                                    <li>Confirmed vulnerabilities: {{ triage_result.confirmed_count }}</li>
                                    <li>False positives: {{ triage_result.false_positive_count }}</li>
                                    <li>Need manual review: {{ triage_result.needs_review_count }}</li>
                                    <li>Analysis time: {{ triage_result.llm_analysis_time_seconds | format_duration }}</li>
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                        
                        {% if triage_result and triage_result.analysis_summary %}
                        <div class="analysis-summary">
                            <h4>üìã Analysis Summary</h4>
                            <pre>{{ triage_result.analysis_summary }}</pre>
                        </div>
                        {% endif %}
                    </div>
                </details>
            </section>
        </main>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- FOOTER -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <footer class="footer">
            <div class="footer-content">
                <p>Generated by <strong>{{ platform_name }}</strong> on {{ generation_timestamp.strftime('%Y-%m-%d at %H:%M:%S') }}</p>
                <p>For questions about this report, contact your security team.</p>
            </div>
        </footer>
    </div>

    {% include 'scripts.html' %}
</body>
</html>
